# Weekly Planner PDF Generation Guide

## Overview
Professional PDF generation system for ACCORD's Weekly Planners with company branding, detailed reporting, and individual staff reports.

## Features

### 1. Summary PDF Report
- **Purpose**: Admin overview of all staff planners for a specific week
- **Includes**:
  - ACCORD company logo and branding
  - Week range and generation metadata
  - Total allowance across all staff
  - Key metrics (total days, average allowance per staff)
  - Staff summary table with:
    - Staff name and employee ID
    - Working days count
    - Weekly allowance (KES formatted)
    - Key locations visited
  - Professional header and footer on each page
  - Confidential watermark

### 2. Individual Staff PDF Report
- **Purpose**: Detailed report for a single staff member
- **Includes**:
  - ACCORD company logo and header
  - Staff information (name, employee ID, email)
  - Week range and total allowance
  - Weekly notes (if any)
  - Complete 5-day schedule table with:
    - Day and date
    - Location/place
    - Transport mode
    - Daily allowance
    - Prospects/targets
  - Summary statistics:
    - Total working days
    - Unique locations visited
    - Transport modes used
    - Average daily allowance
  - Signature lines for staff and supervisor
  - Professional footer with confidential marking

## Technical Implementation

### Libraries Used
- **jsPDF**: Core PDF generation library
- **jspdf-autotable**: Professional table generation with styling

### Installation
```bash
npm install jspdf jspdf-autotable --legacy-peer-deps
```

### File Structure
```
/lib/
  ├── plannerPdfGenerator.ts  # PDF generation utilities
  └── plannerHelpers.ts       # Data processing helpers

/components/dashboard/
  └── planners.tsx            # UI with PDF download buttons

/public/
  └── accordlogo.png          # Company logo for PDFs
```

## Design Specifications

### Color Palette
```typescript
Primary Blue:    #1a56db
Secondary Gray:  #6b7280
Success Green:   #059669
Accent Purple:   #7c3aed
Text:            #111827
Light Gray BG:   #f3f4f6
Border:          #e5e7eb
```

### Typography
- **Headings**: Helvetica Bold (18-20pt)
- **Subheadings**: Helvetica Bold (12-14pt)
- **Body**: Helvetica Normal (9-10pt)
- **Footer**: Helvetica Italic (8pt)

### Layout
- **Page Size**: A4 (210mm × 297mm)
- **Margins**: 15mm all sides
- **Logo**: Top-left, 40mm × 20mm
- **Company Name**: Top-right, 20pt bold
- **Content Width**: 180mm (full width minus margins)

### Branding Elements
1. **Header Section**:
   - ACCORD logo (left)
   - Company name and tagline (right)
   - Primary color divider line

2. **Footer Section**:
   - Page numbers (center)
   - "ACCORD - Confidential" (left)
   - Generation date (right)

3. **Color Accents**:
   - Purple gradient backgrounds for staff cards
   - Green for allowance amounts
   - Blue for primary headings

## Usage

### Generate Summary PDF

```typescript
import { generatePlannersSummaryPDF } from '@/lib/plannerPdfGenerator';

const handleDownloadSummary = async () => {
  const planners = [...]; // Array of planner objects
  const weekRange = {
    from: new Date('2024-01-08'),
    to: new Date('2024-01-12')
  };
  const adminName = 'John Doe';
  
  await generatePlannersSummaryPDF(planners, weekRange, adminName);
};
```

**Output**: `ACCORD_Planner_Summary_Jan_6_-_Jan_12.pdf`

### Generate Individual PDF

```typescript
import { generateIndividualPlannerPDF } from '@/lib/plannerPdfGenerator';

const handleDownloadIndividual = async (planner) => {
  const weekRange = {
    from: new Date('2024-01-08'),
    to: new Date('2024-01-12')
  };
  const adminName = 'John Doe';
  
  await generateIndividualPlannerPDF(planner, weekRange, adminName);
};
```

**Output**: `ACCORD_Planner_John_Doe_Jan_6_-_Jan_12.pdf`

## UI Integration

### Summary PDF Button
Located in the week selector section, generates a comprehensive overview of all visible planners (respects current filters).

```tsx
<button
  onClick={handleGenerateSummaryPDF}
  disabled={generatingPdf || filteredPlanners.length === 0}
  className="bg-black text-white rounded-lg hover:bg-gray-800"
>
  <Download /> Summary PDF
</button>
```

### Individual PDF Button
Each planner card includes a download button for that specific staff member's detailed report.

```tsx
<button
  onClick={() => handleGenerateIndividualPDF(planner)}
  disabled={generatingPdf}
  className="bg-black text-white rounded-lg hover:bg-gray-800"
>
  <Download /> PDF
</button>
```

## PDF Content Details

### Summary Report Structure
1. **Header Page**
   - Logo and company info
   - Report title: "Weekly Planner Summary Report"
   - Week range display
   - Generation timestamp
   - Generated by admin name
   - Total staff count
   - **Total Allowance** (prominent, green, right-aligned)

2. **Key Metrics Box**
   - Light gray background
   - Total planning days
   - Average allowance per staff

3. **Staff Summary Table**
   - Grid layout with borders
   - Alternating row colors
   - Columns:
     - # (index)
     - Staff Name
     - Employee ID
     - Days (working days count)
     - Weekly Allowance (KES, right-aligned, green)
     - Key Locations (truncated if > 30 chars)

### Individual Report Structure
1. **Header Section**
   - Logo and company info
   - Report title: "Individual Weekly Planner"

2. **Staff Info Box** (Purple gradient background)
   - Large staff name
   - Employee ID and email
   - Week range (right)
   - Total allowance (right, large, bold, green)

3. **Generation Metadata**
   - Timestamp
   - Generated by admin

4. **Weekly Notes** (if present)
   - Light gray box
   - Multi-line text support

5. **5-Day Schedule Table**
   - Purple header
   - Columns:
     - Day (bold)
     - Date
     - Location/Place
     - Transport Mode
     - Allowance (right-aligned, bold, green)
     - Prospects/Targets

6. **Summary Statistics Box**
   - Total working days
   - Unique locations list
   - Transport modes used
   - Average daily allowance

7. **Signature Lines**
   - Staff signature (left)
   - Supervisor approval (right)

## Error Handling

### Image Loading Errors
If logo fails to load, PDF generation continues without logo:
```typescript
try {
  const logoImg = await loadImage('/accordlogo.png');
  doc.addImage(logoImg, 'PNG', 15, 10, 40, 20);
} catch (error) {
  console.error('Failed to load logo:', error);
  // Continue without logo
}
```

### PDF Generation Errors
UI shows error state and allows retry:
```typescript
try {
  await generatePlannersSummaryPDF(...);
} catch (err) {
  setError('Failed to generate PDF');
}
```

## Currency Formatting
All allowances displayed in **Kenyan Shillings (KES)**:
```typescript
new Intl.NumberFormat('en-KE', {
  style: 'currency',
  currency: 'KES',
  minimumFractionDigits: 0 // No decimals for whole amounts
})
```

**Examples**:
- `KES 1,500` (daily allowance)
- `KES 7,500` (weekly total)

## Performance Considerations

### PDF Generation Time
- **Summary PDF**: ~1-2 seconds for 10-20 staff
- **Individual PDF**: ~0.5-1 second per report

### Browser Compatibility
- Chrome/Edge: Full support
- Firefox: Full support
- Safari: Full support
- Mobile browsers: Full support (downloads to device)

### File Sizes
- **Summary PDF**: ~50-150 KB (depends on staff count)
- **Individual PDF**: ~30-50 KB per staff

## Future Enhancements

1. **Email Integration**
   - Send PDF directly to staff email
   - Batch email all staff their individual reports

2. **Cloud Storage**
   - Upload PDFs to AWS S3 or similar
   - Generate shareable links

3. **Custom Branding**
   - Allow logo customization per region
   - Configurable color schemes

4. **Advanced Analytics**
   - Multi-week comparison reports
   - Allowance trend charts
   - Location frequency heatmaps

5. **Digital Signatures**
   - Electronic signature integration
   - Approval workflow tracking

6. **Print Optimization**
   - Pre-formatted for A4 printing
   - Print-friendly margins
   - QR codes for verification

## Testing Checklist

- [ ] Logo loads correctly
- [ ] Summary PDF generates with multiple staff
- [ ] Individual PDF generates for single staff
- [ ] Currency formatting shows KES correctly
- [ ] Week range displays properly
- [ ] Tables render with correct alignment
- [ ] Headers/footers on all pages
- [ ] Signature lines visible on last page
- [ ] File names formatted correctly
- [ ] PDFs download to browser
- [ ] Mobile responsive buttons work
- [ ] Loading state shows during generation
- [ ] Error handling works gracefully
- [ ] Multi-page PDFs paginate correctly

## Support & Troubleshooting

### Common Issues

**Logo Not Displaying**:
- Verify `/public/accordlogo.png` exists
- Check file size (< 500KB recommended)
- Ensure PNG format

**Table Overflow**:
- Long location names auto-truncate
- Tables auto-paginate if content exceeds page

**Currency Format Wrong**:
- Verify locale is 'en-KE'
- Check allowance values are numbers

**PDF Not Downloading**:
- Check browser popup blockers
- Verify JavaScript enabled
- Try different browser

---

**Last Updated**: 2024-01-12  
**Version**: 1.0.0  
**Maintained by**: ACCORD Development Team
